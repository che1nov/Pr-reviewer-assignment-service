# Нагрузочное тестирование

## Что проверял

Требования по производительности:
- RPS: 5 запросов в секунду
- Время ответа: до 300 мс
- Успешность: 99.9%

Решил проверить, как сервис справляется с этой нагрузкой.

## Как тестировал

Использовал **k6** - инструмент для нагрузочного тестирования. 

Настройки теста:
- Время 2 минуты
- Постоянная нагрузка 5 RPS
- До 10 виртуальных пользователей
- Тестировал эндпоинты:
  - `GET /health` 
  - `POST /team/add` 
  - `POST /pullRequest/create`
  - `GET /stats`

## Результаты

### Основное

Все требования выполнены с хорошим запасом:

| Что проверял | Нужно было | Получилось | 
|--------------|------------|------------|
| RPS | ≥ 5 | 13.07 |
| Время ответа (P95) | < 300 ms | 39.15 ms |
| Успешность | ≥ 99.9% | 100% |
| Массовая деактивация (P95) | < 100 ms | 34.03 ms |

Сервис справляется с нагрузкой отлично. Массовая деактивация укладывается в требуемые 100 мс.

### Общая статистика

За 2 минуты теста:
- Запросов: 1,570
- Успешных: 1,570 (100%)
- Ошибок: 0
- Средний RPS: 13.07

### Время ответа

| Метрика | Значение |
|---------|----------|
| Среднее | 15.41 ms |
| Медиана | 4.31 ms |
| P90 | 37.48 ms |
| **P95** | **39.15 ms** |
| Максимум | 57.97 ms |

### По эндпоинтам

| Эндпоинт | P95 | Среднее | Макс |
|----------|-----|---------|------|
| `GET /health` | 2.75 ms | 1.96 ms | 6.78 ms |
| `POST /team/add` | 3.49 ms | 2.64 ms | 6.13 ms |
| `POST /pullRequest/create` | 7.58 ms | 5.91 ms | 25.55 ms |
| `POST /team/deactivateUsers` | 34.03 ms | 26.34 ms | 37.46 ms |
| `GET /stats` | 40.81 ms | 34.35 ms | 57.97 ms |

Все эндпоинты укладываются в свои требования. Массовая деактивация (< 100 мс) и остальные (< 300 мс).

## Что заметил

**Создание команды и PR работает быстро** - 3-7 ms, даже с назначением ревьюверов и записью в БД.

**Массовая деактивация укладывается в требование** - 34 ms при лимите 100 ms.

**Статистика самая медленная** - 40 ms, т.к. читает и агрегирует данные по всем PR и пользователям.

**Ни одной ошибки** - из 1570 запросов все прошли успешно. 

## Выводы

Сервис справляется с требуемой нагрузкой без проблем:
- RPS выше требуемого в 2.6 раза
- Все эндпоинты укладываются в свои лимиты с запасом
- Массовая деактивация работает за 34 ms (требование < 100 ms)
- Никаких ошибок за весь тест

Есть хороший запас по производительности.

---

## Как повторить

```bash
# Поднять сервис
docker-compose up -d

# Запустить тест
k6 run load_test.js

# Остановить
docker-compose down
```

Файл `load_test.js` содержит сценарий тестирования.

